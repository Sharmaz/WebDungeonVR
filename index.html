<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Web Dungeon VR</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.8.6/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.rawgit.com/ngokevin/kframe/0d22a890/components/sun-sky/dist/aframe-sun-sky.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img src="assets/suelo.jpg" id="suelo">
        <img src="assets/pared.jpg" id="pared">
      </a-assets>
      <a-entity id="jugador" camera universal-controls position="0 1.6 0" kinematic-body> 
        <a-cursor fuse="true" fuse-timeout="800"> </a-cursor>
        <a-text id="score" value="Hola" width="4" color="black" font="mozillavr" position="0 -.5 -1" anchor="center" align="center"></a-text>
      </a-entity>
      <a-entity id="muros">
      </a-entity>
      <a-entity id="premios">
      </a-entity>
      
      <a-sun-sky material="sunPosition: 300 50 0"></a-sun-sky>
      <a-grid src="#suelo" static-body></a-grid>
    </a-scene>
    <script>
      
      var mapa = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0],
        [1, 0, 0, 0, 0, 0, 0, 3, 1, 0, 0],
        [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0],
        [1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0],
        [1, 0, 0, 0, 3, 1, 1, 0, 1, 0, 0],
        [0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0],
        [0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0],
        [0, 1, 3, 1, 1, 2, 1, 1, 1, 0, 0],
        [0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0]
      ]

      var tamanoPared = 5
      var altoPared = 3
      var muro, premio
      var muros = document.querySelector('#muros')
      var premios = document.querySelector('#premios')
      var scoreEl = document.querySelector('#score')

      for (var x = 0; x < mapa.length; x++) {
          for (var y = 0; y < mapa[x].length; y++) {

              var posicion = (x - mapa.length/2) * tamanoPared + ' ' + 1.5 + ' ' + (y - mapa[x].length/2) * tamanoPared;

              if (mapa[x][y] == 0) {
                  continue
              } 
              else if (mapa[x][y] == 1) {
                  //Pared
                  muro = document.createElement('a-box')
                  muros.appendChild(muro)
                  muro.setAttribute('color', '#fff')
                  muro.setAttribute('material', 'src: #pared')
                  muro.setAttribute('width', tamanoPared)
                  muro.setAttribute('depth', tamanoPared)
                  muro.setAttribute('height', altoPared)
                  muro.setAttribute('position', posicion)
                  muro.setAttribute('static-body', '')

              }
              else if (mapa[x][y] == 2 ) {
                  //Jugador
                  document.querySelector('#jugador').setAttribute('position', posicion)
              }
              else if (mapa[x][y] == 3 ) {
                  //Premio
                  premio = document.createElement('a-sphere')
                  premios.appendChild(premio)
                  premio.setAttribute('position', posicion)
                  premio.setAttribute('class', 'premio')
                  premio.setAttribute('color', 'tomato')
                  premio.setAttribute('radius', '1')   
              }
          }
      }
      var arregloPremios = Array.from(document.querySelectorAll('.premio'))
      var score = arregloPremios.length

      scoreEl.setAttribute('value', 'Faltan ' + score + ' Para Ganar!')

      arregloPremios.forEach(function(premio) {
        premio.addEventListener('click', function() {
          premio.setAttribute('visible', 'false')
          score--
          scoreEl.setAttribute('value', 'Faltan ' + score + ' Para Ganar!')

          if (score <= 0) {
            scoreEl.setAttribute('value', 'Ganaste!!')
          }
        })
      })


    </script>
  </body>
</html>
